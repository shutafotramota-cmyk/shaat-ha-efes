<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>×©×¢×ª ×”××¤×¡ ğŸŒ™</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      color: white;
      --bg1: #2b1055;
      --bg2: #7597de;
    }

    .card {
      background: rgba(255,255,255,0.16);
      backdrop-filter: blur(14px);
      border-radius: 30px;
      padding: 28px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 20px 45px rgba(0,0,0,0.35);
      text-align: center;
      animation: fadeIn 0.9s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(25px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 { margin-top: 0; }

    label { display:block; margin-top:14px; font-size:14px; opacity:0.9; }

    input, select {
      margin-top: 6px;
      padding: 10px;
      border-radius: 16px;
      border: none;
      font-size: 1em;
      width: 100%;
    }

    button {
      margin-top: 20px;
      padding: 16px;
      width: 100%;
      font-size: 1.15em;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #ffe0f7, #d5f3ff);
      color: #2b1055;
      cursor: pointer;
      font-weight: 700;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    button:active {
      transform: scale(0.95);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    #resultIcon {
      font-size: 76px;
      margin-top: 12px;
      animation: pop 0.45s ease;
    }

    @keyframes pop {
      0% { transform: scale(0.4); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    .success { color: #a6ffbe; }
    .fail { color: #ffb3b3; }

    table { width:100%; margin-top:16px; border-collapse:collapse; font-size:13px; }
    th, td { padding:6px; border-bottom:1px solid rgba(255,255,255,0.25); }

    #summary { margin-top: 14px; font-size: 15px; line-height:1.5; }

    .rare {
      margin-top: 10px;
      font-size: 14px;
      animation: fadeIn 0.8s ease;
    }

    #splash {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #1f0c3a, #4a6cc3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.3em;
      z-index: 10;
      animation: fadeIn 1.2s ease;
    }
  </style>
</head>
<body>

<div id="splash">×©×¢×ª ×”××¤×¡ ğŸŒ™</div>

<div class="card" id="app" style="display:none;">
  <h1>×©×¢×ª ×”××¤×¡ ğŸŒ™</h1>

  <label>××™×š × ×§×¨× ×œ×š?</label>
  <input id="username" placeholder="×©×" />

  <label>×©×¢×ª ×©×™× ×” ×¨×¦×•×™×”</label>
  <input type="time" id="sleepTime" />

  <label>×‘×—×™×¨×ª ×¦×‘×¢</label>
  <select id="theme" onchange="changeTheme()">
    <option value="purple">×¡×’×•×œ ×œ×™×œ×™ ğŸ’œ</option>
    <option value="blue">×›×—×•×œ ×©×§×˜ ğŸ’™</option>
    <option value="rose">×•×¨×•×“ ×—××™× ğŸŒ¸</option>
  </select>

  <button onclick="goToSleep()">ğŸŒ™ ×œ×™×œ×” ×˜×•×‘!!!</button>

  <div id="resultIcon"></div>
  <div id="summary"></div>
  <div class="rare" id="rare"></div>

  <table>
    <thead><tr><th>×™×•×</th><th>âœ” / âŒ</th></tr></thead>
    <tbody id="weekly"></tbody>
  </table>
</div>

<script>
  const themes = {
    purple: ['#2b1055', '#7597de'],
    blue: ['#0f2027', '#2c5364'],
    rose: ['#42275a', '#734b6d']
  };

  const successMessages = [
    '×’× ××—×¨ ×ª×—×¡×›×™ ×œ×¢×¦××š ×›××” ×›×•×¡×•×ª ×§×¤×” â˜•ğŸ˜‰',
    ':)',
    '××™×–×• ×‘×—×™×¨×” ×˜×•×‘×” ×œ×¢×¦××š ğŸŒ™',
    '×”×’×•×£ ×©×œ×š ×™×•×“×” ×œ×š ××—×¨ ğŸ’™'
  ];

  const failMessages = [
    '×œ× × ×•×¨× ğŸ’™ ×˜×•×‘ ×©×™×© ×’× ××ª ××—×¨ ×œ× ×¡×•×ª',
    '×’× ×–×” ×—×œ×§ ××ª×”×œ×™×š ğŸŒ±',
    '×”×™×™×ª ×¢×“×™× ×” ×¢× ×¢×¦××š â€” ×–×” × ×—×©×‘',
    '××—×¨ ×œ×™×œ×” ×—×“×© ğŸŒ™'
  ];

  const rareSurprises = [
    'âœ¨ ×”×¤×ª×¢×” × ×“×™×¨×”! ××’×™×¢ ×œ×š ×—×™×‘×•×§ ×œ×¤× ×™ ×”×©×™× ×” âœ¨',
    'ğŸŒŸ ×¨×’×¢ ×§×˜×Ÿ ×©×œ ×’××•×•×” â€” ××ª ××ª××™×“×” ğŸŒŸ',
    'ğŸ’¤ ×©×¢×ª ×”××¤×¡ ×¨××ª×” ××•×ª×š ğŸ’™'
  ];

  const days = ['××³','×‘×³','×’×³','×“×³','×”×³','×•×³','×©×³'];

  function userKey(name, suffix) {
    return 'sleep_' + name + '_' + suffix;
  }

  function changeTheme() {
    const name = document.getElementById('username').value.trim();
    const t = document.getElementById('theme').value;
    document.body.style.setProperty('--bg1', themes[t][0]);
    document.body.style.setProperty('--bg2', themes[t][1]);
    if (name) localStorage.setItem(userKey(name,'theme'), t);
  }

  function goToSleep() {
    const name = document.getElementById('username').value.trim();
    const time = document.getElementById('sleepTime').value;
    if (!name || !time) return;

    localStorage.setItem(userKey(name,'sleepTime'), time);

    const now = new Date();
    const [h,m] = time.split(':').map(Number);
    let target = new Date(now);
    target.setHours(h, m, 0, 0);

    if (h < 12 && now.getHours() >= 12) {
      target.setDate(target.getDate() + 1);
    }

    const success = now <= target;

    const icon = document.getElementById('resultIcon');
    icon.textContent = success ? 'âœ”ï¸ğŸ˜Š' : 'âŒğŸ˜´';
    icon.className = success ? 'success' : 'fail';

    const key = userKey(name,'history');
    const data = JSON.parse(localStorage.getItem(key) || '[]');
    const today = new Date().toDateString();

    if (!data.some(d => new Date(d.date).toDateString() === today)) {
      data.unshift({ date: now.toISOString(), success });
    }

    localStorage.setItem(key, JSON.stringify(data));

    renderWeekly(data);
    renderSummary(data, success);
  }

  function renderWeekly(data) {
    const tbody = document.getElementById('weekly');
    tbody.innerHTML = '';

    data.slice(0,7).reverse().forEach(d => {
      const tr = document.createElement('tr');
      const day = document.createElement('td');
      const res = document.createElement('td');
      const date = new Date(d.date);

      day.textContent = days[date.getDay()];
      res.textContent = d.success ? 'âœ”ï¸' : 'âŒ';
      res.className = d.success ? 'success' : 'fail';

      tr.appendChild(day);
      tr.appendChild(res);
      tbody.appendChild(tr);
    });
  }

  function renderSummary(data, success) {
    const last7 = data.slice(0,7);
    const successCount = last7.filter(d => d.success).length;

    let streak = 0;
    for (let i = 0; i < last7.length; i++) {
      if (last7[i].success) streak++;
      else break;
    }

    const msgs = success ? successMessages : failMessages;
    const msg = msgs[Math.floor(Math.random()*msgs.length)];

    let text = `×”×©×‘×•×¢: ${successCount} ××ª×•×š ${last7.length} ×‘×–××Ÿ ğŸ’™<br>${msg}`;
    if (streak >= 5) text += '<br>âœ¨ 5 ×œ×™×œ×•×ª ×‘×¨×¦×£! ××™×–×” ×”×™×©×’ âœ¨';

    document.getElementById('summary').innerHTML = text;

    const rare = document.getElementById('rare');
    rare.innerHTML = '';
    if (Math.random() < 0.15) {
      rare.textContent = rareSurprises[Math.floor(Math.random()*rareSurprises.length)];
    }
  }

  setTimeout(() => {
    document.getElementById('splash').style.display = 'none';
    document.getElementById('app').style.display = 'block';
  }, 2200);
</script>

</body>
</html>
